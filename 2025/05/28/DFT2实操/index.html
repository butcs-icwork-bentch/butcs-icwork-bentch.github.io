<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>DFT学习（2）实操 | Welcome to butcs-icworkbentch</title><meta name="author" content="butc"><meta name="copyright" content="butc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="本文将对DFT中最常用的scan chain（扫描链）技术进行实操演示。通过具体的操作步骤和代码示例，帮助大家深入理解scan chain的插入、配置、仿真及测试流程。适合有一定DFT基础、希望掌握实际工程操作的同学参考。 理论基础回顾Scan Chain基本原理Scan Chain是DFT中最常用的测试结构，其核心是将普通寄存器替换为扫描寄存器（scan flip-flop）。扫描寄存器在原有D">
<meta property="og:type" content="article">
<meta property="og:title" content="DFT学习（2）实操">
<meta property="og:url" content="https://butcs-icwork-bentch.github.io/2025/05/28/DFT2%E5%AE%9E%E6%93%8D/index.html">
<meta property="og:site_name" content="Welcome to butcs-icworkbentch">
<meta property="og:description" content="本文将对DFT中最常用的scan chain（扫描链）技术进行实操演示。通过具体的操作步骤和代码示例，帮助大家深入理解scan chain的插入、配置、仿真及测试流程。适合有一定DFT基础、希望掌握实际工程操作的同学参考。 理论基础回顾Scan Chain基本原理Scan Chain是DFT中最常用的测试结构，其核心是将普通寄存器替换为扫描寄存器（scan flip-flop）。扫描寄存器在原有D">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/imgOIP-C.png">
<meta property="article:published_time" content="2025-05-28T15:36:00.000Z">
<meta property="article:modified_time" content="2025-06-04T05:22:38.729Z">
<meta property="article:author" content="butc">
<meta property="article:tag" content="DFT，可测性设计，综合">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/imgOIP-C.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "DFT学习（2）实操",
  "url": "https://butcs-icwork-bentch.github.io/2025/05/28/DFT2%E5%AE%9E%E6%93%8D/",
  "image": "https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/imgOIP-C.png",
  "datePublished": "2025-05-28T15:36:00.000Z",
  "dateModified": "2025-06-04T05:22:38.729Z",
  "author": [
    {
      "@type": "Person",
      "name": "butc",
      "url": "https://butcs-icwork-bentch.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://butcs-icwork-bentch.github.io/2025/05/28/DFT2%E5%AE%9E%E6%93%8D/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.3.5"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'DFT学习（2）实操',
  isHighlightShrink: true,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background: transparent;"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/imgshaqiu.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Welcome to butcs-icworkbentch</span></a><a class="nav-page-title" href="/"><span class="site-name">DFT学习（2）实操</span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">DFT学习（2）实操</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-05-28T15:36:00.000Z" title="发表于 2025-05-28 23:36:00">2025-05-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-04T05:22:38.729Z" title="更新于 2025-06-04 13:22:38">2025-06-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/DFT%E7%94%B5%E8%B7%AF/">DFT电路</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>本文将对DFT中最常用的scan chain（扫描链）技术进行实操演示。通过具体的操作步骤和代码示例，帮助大家深入理解scan chain的插入、配置、仿真及测试流程。适合有一定DFT基础、希望掌握实际工程操作的同学参考。</p>
<h1 id="理论基础回顾"><a href="#理论基础回顾" class="headerlink" title="理论基础回顾"></a>理论基础回顾</h1><h2 id="Scan-Chain基本原理"><a href="#Scan-Chain基本原理" class="headerlink" title="Scan Chain基本原理"></a>Scan Chain基本原理</h2><p>Scan Chain是DFT中最常用的测试结构，其核心是将普通寄存器替换为扫描寄存器（scan flip-flop）。扫描寄存器在原有D触发器的基础上增加了MUX结构，通过SE（scan enable）信号控制工作模式：</p>
<ul>
<li>正常工作模式（SE&#x3D;0）：功能与普通D触发器相同</li>
<li>测试模式（SE&#x3D;1）：数据从SI端输入，实现串行扫描功能</li>
</ul>
<h2 id="ATPG（自动测试向量生成）"><a href="#ATPG（自动测试向量生成）" class="headerlink" title="ATPG（自动测试向量生成）"></a>ATPG（自动测试向量生成）</h2><p>ATPG是scan chain测试的关键支撑技术，能够自动生成测试向量。</p>
<p>在接下来的实操部分，我们将基于这些理论知识，通过具体示例演示scan chain的实现过程。</p>
<p>#scanchain插入</p>
<p>##本实践top电路<br>下面是一个4位乘法器的Verilog实现代码：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">module</span> multiplier_4bit(<br>    <span class="hljs-keyword">input</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] a,<br>    <span class="hljs-keyword">input</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] b,<br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] p<br>);<br>    <br>    <span class="hljs-comment">// Partial products</span><br>    <span class="hljs-keyword">wire</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] pp0, pp1, pp2, pp3;<br>    <br>    <span class="hljs-comment">// Generate partial products</span><br>    <span class="hljs-keyword">assign</span> pp0 = b[<span class="hljs-number">0</span>] ? a : <span class="hljs-number">4&#x27;b0000</span>;<br>    <span class="hljs-keyword">assign</span> pp1 = b[<span class="hljs-number">1</span>] ? a : <span class="hljs-number">4&#x27;b0000</span>;<br>    <span class="hljs-keyword">assign</span> pp2 = b[<span class="hljs-number">2</span>] ? a : <span class="hljs-number">4&#x27;b0000</span>;<br>    <span class="hljs-keyword">assign</span> pp3 = b[<span class="hljs-number">3</span>] ? a : <span class="hljs-number">4&#x27;b0000</span>;<br>    <br>    <span class="hljs-comment">// Final product calculation with proper shifting</span><br>    <span class="hljs-keyword">assign</span> p = &#123;<span class="hljs-number">4&#x27;b0000</span>, pp0&#125; + <br>               &#123;<span class="hljs-number">3&#x27;b000</span>, pp1, <span class="hljs-number">1&#x27;b0</span>&#125; + <br>               &#123;<span class="hljs-number">2&#x27;b00</span>, pp2, <span class="hljs-number">2&#x27;b00</span>&#125; + <br>               &#123;<span class="hljs-number">1&#x27;b0</span>, pp3, <span class="hljs-number">3&#x27;b000</span>&#125;;<br>    <br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></table></figure>

<p>这个4位乘法器的工作原理如下：</p>
<ol>
<li>输入两个4位操作数a和b</li>
<li>生成4个部分积（partial products）</li>
<li>通过适当的位移和加法运算得到最终的8位乘积</li>
</ol>
<h2 id="为乘法器加入（不完备）LBIST测试结构"><a href="#为乘法器加入（不完备）LBIST测试结构" class="headerlink" title="为乘法器加入（不完备）LBIST测试结构"></a>为乘法器加入（不完备）LBIST测试结构</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">// 纯LBIST结构乘法器(无扫描链)</span><br><span class="hljs-keyword">module</span> multiplier_4bit_lbist(<br>    <span class="hljs-keyword">input</span> clk,           <span class="hljs-comment">// 时钟信号</span><br>    <span class="hljs-keyword">input</span> rst_n,         <span class="hljs-comment">// 复位信号</span><br>    <span class="hljs-keyword">input</span> test_mode,     <span class="hljs-comment">// 测试模式信号</span><br>    <span class="hljs-keyword">input</span> bist_en,       <span class="hljs-comment">// BIST使能信号</span><br>    <span class="hljs-keyword">input</span> bist_start,    <span class="hljs-comment">// BIST启动信号</span><br>    <span class="hljs-keyword">input</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] a,       <span class="hljs-comment">// 乘数a</span><br>    <span class="hljs-keyword">input</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] b,       <span class="hljs-comment">// 乘数b</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] p,      <span class="hljs-comment">// 乘法结果</span><br>    <span class="hljs-keyword">output</span> bist_done,    <span class="hljs-comment">// BIST完成标志</span><br>    <span class="hljs-keyword">output</span> bist_pass     <span class="hljs-comment">// BIST通过标志</span><br>);<br><br>    <span class="hljs-comment">// 内部信号</span><br>    <span class="hljs-keyword">wire</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] a_mux, b_mux;<br>    <span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] p_internal;<br>    <span class="hljs-keyword">wire</span> bist_active;    <span class="hljs-comment">// BIST激活信号</span><br>    <br>    <span class="hljs-comment">// BIST只有在test_mode和bist_en同时为1时才激活</span><br>    <span class="hljs-keyword">assign</span> bist_active = test_mode &amp;&amp; bist_en;<br>    <br>    <span class="hljs-comment">//===== LFSR - 线性反馈移位寄存器 =====</span><br>    <span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] lfsr;<br>    <span class="hljs-keyword">wire</span> lfsr_feedback = lfsr[<span class="hljs-number">7</span>] ^ lfsr[<span class="hljs-number">5</span>] ^ lfsr[<span class="hljs-number">4</span>] ^ lfsr[<span class="hljs-number">3</span>]; <span class="hljs-comment">// 多项式: x^8 + x^6 + x^5 + x^4 + 1</span><br>    <br>    <span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk <span class="hljs-keyword">or</span> <span class="hljs-keyword">negedge</span> rst_n) <span class="hljs-keyword">begin</span><br>        <span class="hljs-keyword">if</span> (!rst_n)<br>            lfsr &lt;= <span class="hljs-number">8&#x27;hFF</span>; <span class="hljs-comment">// 初始种子</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (bist_active)<br>            lfsr &lt;= &#123;lfsr[<span class="hljs-number">6</span>:<span class="hljs-number">0</span>], lfsr_feedback&#125;;<br>    <span class="hljs-keyword">end</span><br>    <br>    <span class="hljs-comment">// 输入多路复用器</span><br>    <span class="hljs-keyword">assign</span> a_mux = bist_active ? lfsr[<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] : a;<br>    <span class="hljs-keyword">assign</span> b_mux = bist_active ? lfsr[<span class="hljs-number">7</span>:<span class="hljs-number">4</span>] : b;<br>    <br>    <span class="hljs-comment">// 乘法器核心实例化</span><br>    multiplier_4bit core_mult(<br>        <span class="hljs-variable">.a</span>(a_mux),<br>        <span class="hljs-variable">.b</span>(b_mux),<br>        <span class="hljs-variable">.p</span>(p_internal)<br>    );<br>    <br>    <span class="hljs-comment">//===== MISR - 多输入签名寄存器 =====</span><br>    <span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] misr;<br>    <span class="hljs-keyword">wire</span> misr_feedback = misr[<span class="hljs-number">7</span>] ^ misr[<span class="hljs-number">5</span>] ^ misr[<span class="hljs-number">3</span>] ^ misr[<span class="hljs-number">0</span>] ^ p_internal[<span class="hljs-number">0</span>];<br>    <br>    <span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk <span class="hljs-keyword">or</span> <span class="hljs-keyword">negedge</span> rst_n) <span class="hljs-keyword">begin</span><br>        <span class="hljs-keyword">if</span> (!rst_n)<br>            misr &lt;= <span class="hljs-number">8&#x27;h00</span>;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (bist_active)<br>            misr &lt;= &#123;misr[<span class="hljs-number">6</span>:<span class="hljs-number">0</span>], misr_feedback&#125; ^ &#123;p_internal[<span class="hljs-number">7</span>:<span class="hljs-number">1</span>], <span class="hljs-number">1&#x27;b0</span>&#125;;<br>    <span class="hljs-keyword">end</span><br>    <br>    <span class="hljs-comment">//===== BIST 控制器 =====</span><br>    <span class="hljs-keyword">reg</span> [<span class="hljs-number">9</span>:<span class="hljs-number">0</span>] bist_counter; <span class="hljs-comment">// 支持最多1024个测试向量</span><br>    <span class="hljs-keyword">reg</span> bist_running;<br>    <span class="hljs-keyword">reg</span> bist_done_reg;<br>    <span class="hljs-keyword">reg</span> bist_pass_reg;<br>    <span class="hljs-keyword">reg</span> next_bist_running;<br>    <span class="hljs-keyword">reg</span> next_bist_done;<br>    <span class="hljs-keyword">reg</span> next_bist_pass;<br>    <span class="hljs-keyword">reg</span> [<span class="hljs-number">9</span>:<span class="hljs-number">0</span>] next_bist_counter;<br>    <br>    <span class="hljs-comment">// 期望的签名值 - 需要针对特定设计通过仿真确定</span><br>    <span class="hljs-keyword">parameter</span> EXPECTED_SIGNATURE = <span class="hljs-number">8&#x27;h8b</span>; <br>    <br>    <span class="hljs-comment">// FSM 时序逻辑部分</span><br>    <span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk <span class="hljs-keyword">or</span> <span class="hljs-keyword">negedge</span> rst_n) <span class="hljs-keyword">begin</span><br>        <span class="hljs-keyword">if</span> (!rst_n) <span class="hljs-keyword">begin</span><br>            bist_counter &lt;= <span class="hljs-number">10&#x27;d0</span>;<br>            bist_running &lt;= <span class="hljs-number">1&#x27;b0</span>;<br>            bist_done_reg &lt;= <span class="hljs-number">1&#x27;b0</span>;<br>            bist_pass_reg &lt;= <span class="hljs-number">1&#x27;b0</span>;<br>        <span class="hljs-keyword">end</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span><br>            bist_counter &lt;= next_bist_counter;<br>            bist_running &lt;= next_bist_running;<br>            bist_done_reg &lt;= next_bist_done;<br>            bist_pass_reg &lt;= next_bist_pass;<br>        <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">end</span><br>    <br>    <span class="hljs-comment">// FSM 组合逻辑部分</span><br>    <span class="hljs-keyword">always</span> @(*) <span class="hljs-keyword">begin</span><br>        <span class="hljs-comment">// 默认值保持当前状态</span><br>        next_bist_counter = bist_counter;<br>        next_bist_running = bist_running;<br>        next_bist_done = bist_done_reg;<br>        next_bist_pass = bist_pass_reg;<br>        <br>        <span class="hljs-keyword">if</span> (bist_active &amp;&amp; bist_start &amp;&amp; !bist_running &amp;&amp; !bist_done_reg) <span class="hljs-keyword">begin</span><br>            next_bist_running = <span class="hljs-number">1&#x27;b1</span>;<br>            next_bist_counter = <span class="hljs-number">10&#x27;d0</span>;<br>        <span class="hljs-keyword">end</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (bist_running) <span class="hljs-keyword">begin</span><br>            <span class="hljs-keyword">if</span> (bist_counter == <span class="hljs-number">10&#x27;d511</span>) <span class="hljs-keyword">begin</span> <span class="hljs-comment">// 运行512个测试向量</span><br>                next_bist_running = <span class="hljs-number">1&#x27;b0</span>;<br>                next_bist_done = <span class="hljs-number">1&#x27;b1</span>;<br>                next_bist_pass = (misr == EXPECTED_SIGNATURE);<br>            <span class="hljs-keyword">end</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span><br>                next_bist_counter = bist_counter + <span class="hljs-number">1&#x27;b1</span>;<br>            <span class="hljs-keyword">end</span><br>        <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">end</span><br>    <br>    <span class="hljs-comment">// 输出多路复用器</span><br>    <span class="hljs-keyword">assign</span> p = bist_active ? misr : p_internal;<br>    <span class="hljs-keyword">assign</span> bist_done = bist_done_reg;<br>    <span class="hljs-keyword">assign</span> bist_pass = bist_pass_reg;<br>    <br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></table></figure>
<p>LBIST结构的主要优势在于无需复杂的外部测试设备就能完成片上测试，适用于生产测试、上电自检以及在线测试等场景。这一篇博客主要讲scanchain的插入，就先不深究bist的组成了，下一篇会详细说明bist的构成。</p>
<p>##代码前仿真<br>使用modulesim对verilog代码进行综合前仿真，保证代码逻辑正确</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">timescale</span> 1ns/1ps</span><br><br><span class="hljs-keyword">module</span> multiplier_tb;<br>    <br>    <span class="hljs-comment">// 测试激励信号</span><br>    <span class="hljs-keyword">reg</span> clk;                <span class="hljs-comment">// 时钟信号</span><br>    <span class="hljs-keyword">reg</span> rst_n;              <span class="hljs-comment">// 复位信号</span><br>    <span class="hljs-keyword">reg</span> test_mode;          <span class="hljs-comment">// 测试模式选择</span><br>    <span class="hljs-keyword">reg</span> bist_en;            <span class="hljs-comment">// BIST使能信号</span><br>    <span class="hljs-keyword">reg</span> bist_start;         <span class="hljs-comment">// BIST启动信号</span><br>    <span class="hljs-keyword">reg</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] a;            <span class="hljs-comment">// 输入乘数a</span><br>    <span class="hljs-keyword">reg</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] b;            <span class="hljs-comment">// 输入乘数b</span><br>    <br>    <span class="hljs-comment">// 输出信号</span><br>    <span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] p;           <span class="hljs-comment">// 乘法结果</span><br>    <span class="hljs-keyword">wire</span> bist_done;         <span class="hljs-comment">// BIST完成信号</span><br>    <span class="hljs-keyword">wire</span> bist_pass;         <span class="hljs-comment">// BIST通过信号</span><br>    <br>    <span class="hljs-comment">// 内部信号监控</span><br>    <span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] lfsr_value;<br>    <span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] misr_value;<br>    <span class="hljs-keyword">wire</span> bist_running;<br>    <span class="hljs-keyword">wire</span> [<span class="hljs-number">9</span>:<span class="hljs-number">0</span>] counter_val;<br>    <br>    <span class="hljs-comment">// 捕获第511拍的MISR值</span><br>    <span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] misr_511;<br>    <span class="hljs-keyword">reg</span> misr_captured;<br>    <br>    <span class="hljs-comment">// 测试验证用的参考信号</span><br>    <span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] expected_p;<br>    <br>    <span class="hljs-comment">// 实例化被测设计</span><br>    multiplier_4bit_lbist dut (<br>        <span class="hljs-variable">.clk</span>(clk),<br>        <span class="hljs-variable">.rst_n</span>(rst_n),<br>        <span class="hljs-variable">.test_mode</span>(test_mode),<br>        <span class="hljs-variable">.bist_en</span>(bist_en),<br>        <span class="hljs-variable">.bist_start</span>(bist_start),<br>        <span class="hljs-variable">.a</span>(a),<br>        <span class="hljs-variable">.b</span>(b),<br>        <span class="hljs-variable">.p</span>(p),<br>        <span class="hljs-variable">.bist_done</span>(bist_done),<br>        <span class="hljs-variable">.bist_pass</span>(bist_pass)<br>    );<br>    <br>    <span class="hljs-comment">// 连接内部信号用于监控</span><br>    <span class="hljs-keyword">assign</span> lfsr_value = dut<span class="hljs-variable">.lfsr</span>;<br>    <span class="hljs-keyword">assign</span> misr_value = dut<span class="hljs-variable">.misr</span>;<br>    <span class="hljs-keyword">assign</span> bist_running = dut<span class="hljs-variable">.bist_running</span>;<br>    <span class="hljs-keyword">assign</span> counter_val = dut<span class="hljs-variable">.bist_counter</span>;<br>    <br>    <span class="hljs-comment">// 时钟生成: 100MHz</span><br>    <span class="hljs-keyword">always</span> <span class="hljs-keyword">begin</span><br>        #<span class="hljs-number">5</span> clk = ~clk;<br>    <span class="hljs-keyword">end</span><br>    <br>    <span class="hljs-comment">// 乘法功能验证任务</span><br>    <span class="hljs-keyword">task</span> verify_multiplication;<br>        <span class="hljs-keyword">input</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] in_a;<br>        <span class="hljs-keyword">input</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] in_b;<br>        <span class="hljs-keyword">begin</span><br>            a = in_a;<br>            b = in_b;<br>            expected_p = in_a * in_b; <span class="hljs-comment">// 预期结果</span><br>            #<span class="hljs-number">20</span>; <span class="hljs-comment">// 等待组合逻辑稳定</span><br>            <br>            <span class="hljs-comment">// 验证结果</span><br>            <span class="hljs-keyword">if</span>(p == expected_p)<br>                <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;Verification Passed: %d * %d = %d&quot;</span>, a, b, p);<br>            <span class="hljs-keyword">else</span><br>                <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;Verification Failed: %d * %d = %d (Expected: %d)&quot;</span>, a, b, p, expected_p);<br>        <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">endtask</span><br>    <br>    <span class="hljs-comment">// MISR值监控进程 - 捕获第511拍的值</span><br>    <span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk) <span class="hljs-keyword">begin</span><br>        <span class="hljs-comment">// 监控第511个测试向量的MISR值</span><br>        <span class="hljs-keyword">if</span> (bist_running &amp;&amp; counter_val == <span class="hljs-number">10&#x27;d510</span>) <span class="hljs-keyword">begin</span><br>            <span class="hljs-comment">// 当计数器为510时，下一个时钟周期会是511</span><br>            @(<span class="hljs-keyword">posedge</span> clk);<br>            <span class="hljs-keyword">if</span> (bist_running) <span class="hljs-keyword">begin</span><br>                misr_511 = misr_value;<br>                <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;Captured MISR at vector 511: 8&#x27;h%h&quot;</span>, misr_value);<br>            <span class="hljs-keyword">end</span><br>        <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">end</span><br>    <br>    <span class="hljs-comment">// 解决高阻态的基本测试</span><br>    <span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>        <span class="hljs-comment">// 初始化所有输入信号，避免高阻态</span><br>        clk = <span class="hljs-number">0</span>;<br>        rst_n = <span class="hljs-number">0</span>;  <span class="hljs-comment">// 激活复位</span><br>        test_mode = <span class="hljs-number">0</span>;<br>        bist_en = <span class="hljs-number">0</span>;<br>        bist_start = <span class="hljs-number">0</span>;<br>        a = <span class="hljs-number">4&#x27;h3</span>;<br>        b = <span class="hljs-number">4&#x27;h5</span>;<br>        misr_captured = <span class="hljs-number">0</span>;<br>        misr_511 = <span class="hljs-number">8&#x27;h00</span>;<br>        <br>        <span class="hljs-comment">// 复位释放</span><br>        #<span class="hljs-number">50</span>;<br>        rst_n = <span class="hljs-number">1</span>;<br>        #<span class="hljs-number">20</span>;<br>        <br>        <span class="hljs-comment">// 测试BIST模式</span><br>        #<span class="hljs-number">50</span>;<br>        <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;Starting BIST test...&quot;</span>);<br>        test_mode = <span class="hljs-number">1</span>;  <span class="hljs-comment">// 切换到测试模式</span><br>        bist_en = <span class="hljs-number">1</span>;    <span class="hljs-comment">// 使能BIST</span><br>        #<span class="hljs-number">20</span>;<br>        bist_start = <span class="hljs-number">1</span>;  <span class="hljs-comment">// 启动BIST</span><br>        #<span class="hljs-number">20</span>;<br>        bist_start = <span class="hljs-number">0</span>;<br>        <br>        <span class="hljs-comment">// 等待BIST完成</span><br>        <span class="hljs-keyword">wait</span>(bist_done);<br>        <br>        <span class="hljs-comment">// 显示最终结果和比较值</span><br>        <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;Final MISR value: 8&#x27;h%h (value after BIST completion)&quot;</span>, misr_value);<br>        <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;MISR at vector 511: 8&#x27;h%h (value used for comparison)&quot;</span>, misr_511);<br>        <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;BIST result: %s&quot;</span>, bist_pass ? <span class="hljs-string">&quot;pass&quot;</span> : <span class="hljs-string">&quot;fail&quot;</span>);<br>        <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;Number of test vectors: %0d&quot;</span>, counter_val + <span class="hljs-number">1</span>);<br>        <br>        <span class="hljs-comment">// 提供参数更新指导</span><br>        <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;\nExample to update EXPECTED_SIGNATURE parameter:&quot;</span>);<br>        <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;parameter EXPECTED_SIGNATURE = 8&#x27;h%h;&quot;</span>, misr_511);<br>        <br>        #<span class="hljs-number">100</span> ;<br>    <span class="hljs-keyword">end</span><br>  <br><span class="hljs-keyword">endmodule</span> <br></code></pre></td></tr></table></figure>

<h3 id="前仿真测试过程概述"><a href="#前仿真测试过程概述" class="headerlink" title="前仿真测试过程概述"></a>前仿真测试过程概述</h3><p>上述测试台代码实现了对LBIST乘法器的全面验证，主要测试过程包括：</p>
<p> <strong>功能测试</strong>：通过<code>verify_multiplication</code>任务可以验证乘法器在正常模式下的功能正确性，比较实际输出与预期结果。</p>
<p> <strong>BIST测试流程</strong>：</p>
<ul>
<li>激活测试模式和BIST使能</li>
<li>发送BIST启动信号</li>
<li>等待BIST完成（监控bist_done信号）</li>
<li>检查BIST结果（bist_pass信号）<br> <strong>结果分析</strong>：</li>
<li>显示最终MISR值与第511个向量的MISR值</li>
<li>判断BIST测试是否通过</li>
<li>提供更新EXPECTED_SIGNATURE参数的建议值（bist标志已经事先通过仿真选择正确）</li>
</ul>
<p>这个tb不仅验证了乘法器的功能正确性，还能帮助确定BIST期望签名值，为后续的综合和测试向量生成提供基础。通过监控内部信号，可以深入了解BIST的工作机制和测试覆盖情况。</p>
<h2 id="RTL前仿真结果"><a href="#RTL前仿真结果" class="headerlink" title="RTL前仿真结果"></a>RTL前仿真结果</h2><p>仿真输出主要看两点：<br> <strong>1，功能模式时输出是否正确</strong><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/img20250528191314004.png"><br>通过上图可以看出在mode信号上升之前，输出p始终等于a*b，但是有一个小问题，就是rst好像没用，这应该是代码逻辑出了错，但无奈在写下这段话时，此电路，drc和lvs都通过了（苦涩）<br> <strong>2，是否在512个自生成随机测试向量之后报告正确</strong><br> 什么意思呢，就是电路有一个bist_pass端口，当自测试成功了就报1，测试失败就一直是0，这部分功能会在下一篇详细讲解，先看图。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/img20250528192057026.png"><br>可以看到，黄线附近bist_done和pass同时拉高！那就说明咱们的电路基本逻辑没什么问题，另外，在测试模式时，输出端自动输出misr的值，可以提供给外部测试人员查看，提高了电路测试的可观测性。</p>
<h2 id="使用Design-Compiler-DFT综合并插入scanchain"><a href="#使用Design-Compiler-DFT综合并插入scanchain" class="headerlink" title="使用Design Compiler DFT综合并插入scanchain"></a>使用Design Compiler DFT综合并插入scanchain</h2><p><strong>本设计所用pdk为saed90nm标准单元库</strong><br>首先定义文件位置</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs tcl"><span class="hljs-keyword">set</span> top <span class="hljs-string">&quot;multiplier_4bit_lbist&quot;</span><br><br><br><span class="hljs-comment">#############################################################################</span><br><span class="hljs-comment">#standard cell library</span><br><br><span class="hljs-keyword">set</span> stdcel_libs <span class="hljs-string">&quot;</span><br><span class="hljs-string">/home/crazy/Desktop/EDA/library/stdcel/db/ss1p08v125c/saed90nm_max_hth_cg.db</span><br><span class="hljs-string">/home/crazy/Desktop/EDA/library/stdcel/db/ss1p08v125c/saed90nm_max_hth_cg_hvt.db</span><br><span class="hljs-string">/home/crazy/Desktop/EDA/library/stdcel/db/ss1p08v125c/saed90nm_max_hth_cg_lvt.db</span><br><span class="hljs-string">/home/crazy/Desktop/EDA/library/stdcel/db/ss1p08v125c/saed90nm_max_hth.db</span><br><span class="hljs-string">/home/crazy/Desktop/EDA/library/stdcel/db/ss1p08v125c/saed90nm_max_hth_hvt.db</span><br><span class="hljs-string">/home/crazy/Desktop/EDA/library/stdcel/db/ss1p08v125c/saed90nm_max_hth_lvt.db</span><br><span class="hljs-string">&quot;</span><br><br><span class="hljs-comment"># memory</span><br><span class="hljs-keyword">set</span> memory_libs <span class="hljs-string">&quot;</span><br><span class="hljs-string">/home/crazy/Desktop/EDA/library/mem/db/ss1p08v125c/SRAM8x1024_1rw_max_hth_pg.db</span><br><span class="hljs-string">/home/crazy/Desktop/EDA/library/mem/db/ss1p08v125c/SRAM8x128_max_hth_pg.db</span><br><span class="hljs-string">&quot;</span><br><br><span class="hljs-keyword">set</span> target_library <span class="hljs-string">&quot;$stdcel_libs&quot;</span><br><span class="hljs-keyword">set</span> link_library   <span class="hljs-string">&quot;* $target_library $memory_libs&quot;</span><br><br><span class="hljs-comment">#############################################################################</span><br><br>set_app_var enable_page_mode false<br></code></pre></td></tr></table></figure>

<p>进行逻辑综合</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs tcl">sh mkdir -p ../rpts<br><br>sh mkdir -p ../output_data<br><br>set_svf ../output_data/<span class="hljs-variable">$&#123;top&#125;</span>.svf<br><br>define_design_lib temp_work -path ./tmp_work<br><span class="hljs-comment">#analyze -format verilog $&#123;RTL_SOURCE_FILES&#125;</span><br><span class="hljs-comment">#elaborate $&#123;DESIGN_NAME&#125;</span><br><br>read_verilog &#123;/home/crazy/Desktop/EDA/code/cfq_top.v /home/crazy/Desktop/EDA/code/cfq.v&#125;<br><br>current_design <span class="hljs-variable">$top</span><br><br>link<br><br><span class="hljs-comment">#sdc</span><br>read_sdc /home/crazy/Desktop/EDA/SDC/cfq.sdc<br><br>set_operating_conditions -max WORST -max_library saed90nm_max_hth \<br>		 -min WORST -min_library saed90nm_max_hth<br><br>set_app_var auto_wire_load_selection false     # 禁用自动线负载选择<br><br>set_wire_load_model  -name <span class="hljs-number">8000</span><br><br>set_wire_load_mode top<br><br>set_max_leakage_power <span class="hljs-number">0</span><br><br>set_max_area <span class="hljs-number">0</span><br><br>set_dont_touch_network [get_ports clk]         # 设置时钟端口为don&#x27;t touch网络<br><br>set_ideal_network [get_port clk]               # 设置时钟为理想网络<br><br><span class="hljs-keyword">set</span> ports_clock_root [filter_collection [get_attribute [get_clocks] sources] object_class==port]  # 获取时钟根端口<br><br>group_path -name reg2out -from [all_registers -clock_pins] -to [all_outputs]       # 分组寄存器到输出路径<br>group_path -name in2reg -from [remove_from_collection [all_inputs] <span class="hljs-variable">$ports_clock_root</span>] -to [all_registers -data_pins]  # 分组输入到寄存器路径<br>group_path -name in2out -from [remove_from_collection [all_inputs] <span class="hljs-variable">$ports_clock_root</span>] -to [all_outputs]  # 分组输入到输出路径<br><br>set_critical_range <span class="hljs-number">3</span> [current_design]          # 设置关键范围<br><br>set_clock_gating_style \<br>    -control_point before \<br>    -max_fanout <span class="hljs-number">32</span> \<br>    -no_sharing \<br>    -minimum_bitwidth <span class="hljs-number">8</span> \<br>    -sequential_cell latch<br><br><span class="hljs-comment">#extra cmds</span><br><span class="hljs-comment">#set_structure false</span><br><span class="hljs-comment">#set_flatten true -effort high</span><br><br>compile_ultra -gate_clock -<span class="hljs-keyword">scan</span><br><br>report_constraint -all_violators  &gt; ../rpts/all_vios1.rpt<br><br>compile_ultra -incremental -<span class="hljs-keyword">scan</span>               # 增量编译，继续扫描准备<br><br>report_constraint -all_violators  &gt; ../rpts/all_vios1.<span class="hljs-keyword">incr</span>.rpt<br><br>set_svf -off                                   # 关闭SVF记录<br><br><span class="hljs-comment">#outpu data</span><br>change_names -rules verilog -hierarchy         # 修改名称以符合Verilog规则<br><br>write -<span class="hljs-keyword">format</span> ddc -hierarchy -output ../output_data/<span class="hljs-variable">$&#123;top&#125;</span>.mappedscan.ddc<br><br>write -f verilog -hierarchy -output ../output_data/<span class="hljs-variable">$&#123;top&#125;</span>.mappedscan.v<br></code></pre></td></tr></table></figure>

<p>插入扫描链</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs tcl"><span class="hljs-comment">##############################################</span><br><span class="hljs-comment">############### insert scan chain ############</span><br><span class="hljs-comment">##############################################</span><br>set_dft_insertion_configuration -preserve_design_name true    # 保留设计名称<br><br><span class="hljs-comment"># Do not run incremental compile as a part of insert_dft</span><br>set_dft_insertion_configuration -synthesis_optimization none  # 禁用DFT插入过程中的综合优化<br><br>create_port -direction in &#123;scan_en&#125;<br>create_port -direction in &#123;si[<span class="hljs-number">0</span>]&#125;<br>create_port -direction in &#123;si[<span class="hljs-number">1</span>]&#125;<br>create_port -direction out &#123;so[<span class="hljs-number">0</span>]&#125;<br>create_port -direction out &#123;so[<span class="hljs-number">1</span>]&#125;<br><br><br>set_dft_signal -view spec -type ScanDataIn -port si[*]<br>set_dft_signal -view spec -type ScanDataOut -port so[*]<br>set_dft_signal -view existing_dft -port clk -type ScanClock -timing &#123;<span class="hljs-number">45</span> <span class="hljs-number">55</span>&#125;<br>set_dft_signal -view spec -type ScanEnable -port scan_en  -active_state <span class="hljs-number">1</span> <br>set_dft_signal -view existing_dft -type Constant -port test_mode -active_state <span class="hljs-number">1</span> <br>set_dft_signal -view existing_dft -type Reset -port rst_n -active_state <span class="hljs-number">0</span><br><span class="hljs-comment">#set_dft_signal -view existing_dft -type ScanClock -port [get_ports scan_clk] -timing &#123;45 55&#125;</span><br><span class="hljs-comment">#set_dft_signal -view spec -type ScanClock -port [get_ports scan_clk];# -timing &#123;45 55&#125;</span><br>set_scan_configuration -chain_count <span class="hljs-number">2</span><br><br>set_scan_configuration -chain_count <span class="hljs-number">2</span>   # 设置扫描链数量为<span class="hljs-number">2</span>条<br></code></pre></td></tr></table></figure>

<p>声明BIST信号</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs tcl"><br><span class="hljs-comment">##############################################</span><br><span class="hljs-comment">############### LBIST configuration ##########</span><br><span class="hljs-comment">##############################################</span><br><span class="hljs-comment"># LBIST信号定义 - 使用正确的DC信号类型</span><br>set_dft_signal -view existing_dft -type TestClock -port clk -timing &#123;<span class="hljs-number">45</span> <span class="hljs-number">55</span>&#125;<br>set_dft_signal -view existing_dft -type TestMode -port test_mode -active_state <span class="hljs-number">1</span><br>set_dft_signal -view existing_dft -type TestData -port bist_en<br>set_dft_signal -view existing_dft -type TestData -port bist_start<br><span class="hljs-comment">#set_dft_signal -view existing_dft -type TestData -port bist_done </span><br><span class="hljs-comment">#set_dft_signal -view existing_dft -type TestData -port bist_pass </span><br></code></pre></td></tr></table></figure>

<p>autofix修复DFT电路设置</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs tcl"><span class="hljs-comment">####autofix</span><br>set_dft_configuration -fix_set enable -fix_reset enable -fix_clock enable  # 启用自动修复功能<br><br>set_dft_signal -view spec -type TestMode -active_state <span class="hljs-number">1</span> -port test_mode   # 指定测试模式信号<br>set_dft_signal -view spec -port clk -type TestData                         # 设置时钟为测试数据类型<br><br>set_autofix_configuration -type <span class="hljs-keyword">clock</span> -control test_mode -test_data clk    # 配置时钟自动修复<br>set_autofix_configuration -type reset -method mux -control test_mode -test_data rst_n  # 配置复位自动修复<br>set_autofix_configuration -type <span class="hljs-keyword">set</span> -method mux -control test_mode -test_data rst_n    # 配置置位自动修复<br></code></pre></td></tr></table></figure>

<p>创建test_protocol并插入DFT电路</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs tcl">create_test_protocol<br><span class="hljs-comment">#dft_drc</span><br><span class="hljs-comment">#report_scan_configuration</span><br><span class="hljs-comment">#report_dft_insertion_configuration</span><br><span class="hljs-comment">#preview_dft</span><br>insert_dft<br></code></pre></td></tr></table></figure>

<p>输出文件设置</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs tcl">change_names -rules verilog -hierarchy<br>write_scan_def -output ../output_data/<span class="hljs-variable">$&#123;top&#125;</span>.mapped.<span class="hljs-keyword">scan</span>.def<br><br><span class="hljs-comment">#disconnect_net data_source [get_port data_source]</span><br><span class="hljs-comment">#remove_port data_source</span><br><span class="hljs-comment">#create_port -direction in scan_clk</span><br><span class="hljs-comment">#connect_net data_source scan_clk</span><br><br><br><span class="hljs-comment">#compile_ultra -incremental -scan</span><br><br><span class="hljs-comment">#outpu data</span><br>write -<span class="hljs-keyword">format</span> ddc -hierarchy -output ../output_data/<span class="hljs-variable">$&#123;top&#125;</span>.mapped.<span class="hljs-keyword">scan</span>.ddc<br>write -f verilog -hierarchy -output ../output_data/<span class="hljs-variable">$&#123;top&#125;</span>.mapped.<span class="hljs-keyword">scan</span>.v<br><br><span class="hljs-comment"># 生成SDF文件</span><br>write_sdf -version <span class="hljs-number">2.1</span> -context verilog ../output_data/<span class="hljs-variable">$&#123;top&#125;</span>.mapped.<span class="hljs-keyword">scan</span>.sdf<br><br>write_test_protocol -output ../output_data/<span class="hljs-variable">$&#123;top&#125;</span>.mapped.<span class="hljs-keyword">scan</span>.spf<br><br></code></pre></td></tr></table></figure>

<p>以上脚本实现了完整的DFT前端综合流程，从设计读取、逻辑综合到扫描链插入、BIST信号配置和自动修复，最终生成带有可测试性结构的网表和测试协议文件，为后续的测试向量生成和芯片测试奠定基础。</p>
<h2 id="DC重要报告反馈"><a href="#DC重要报告反馈" class="headerlink" title="DC重要报告反馈"></a>DC重要报告反馈</h2><h3 id="在进行link之后DC会打开自带的DHL-Compiler对v代码进行编译"><a href="#在进行link之后DC会打开自带的DHL-Compiler对v代码进行编译" class="headerlink" title="在进行link之后DC会打开自带的DHL Compiler对v代码进行编译"></a>在进行link之后DC会打开自带的DHL Compiler对v代码进行编译</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/img20250528193034764.png"></p>
<p>HDLC反馈表格中各列的含义如下：<br><strong>Register Name</strong> - 寄存器名称：被识别的寄存器实例名称</p>
<p><strong>Type</strong> - 类型：大多数情况下是Flip-flop（触发器）</p>
<p><strong>Width</strong> - 位宽：寄存器的位宽，如8位、1位或10位等</p>
<p><strong>Bus</strong> - 总线标志：</p>
<ul>
<li>Y：表示这是一个总线寄存器（多位寄存器）</li>
<li>N：表示这是单比特寄存器</li>
</ul>
<p><strong>MB</strong> - 多位（Multiple Bit）标志：</p>
<ul>
<li>Y：表示寄存器包含多个位</li>
<li>N：表示单比特寄存器</li>
</ul>
<p><strong>AR</strong> - 异步复位（Asynchronous Reset）标志：</p>
<ul>
<li>Y：表示寄存器有异步复位功能</li>
<li>N：表示没有异步复位</li>
</ul>
<p><strong>AS</strong> - 异步置位（Asynchronous Set）标志：</p>
<ul>
<li>Y：表示寄存器有异步置位功能</li>
<li>N：表示没有异步置位</li>
</ul>
<p><strong>SR</strong> - 同步复位（Synchronous Reset）标志：</p>
<ul>
<li>Y：表示寄存器有同步复位功能</li>
<li>N：表示没有同步复位</li>
</ul>
<p><strong>SS</strong> - 同步置位（Synchronous Set）标志：</p>
<ul>
<li>Y：表示寄存器有同步置位功能</li>
<li>N：表示没有同步置位</li>
</ul>
<p><strong>ST</strong> - 扫描测试（Scan Test）标志：</p>
<ul>
<li>Y：表示寄存器已配置为扫描测试模式</li>
<li>N：表示尚未配置为扫描测试模式</li>
</ul>
<p>在示例中，<code>lfsr_reg</code>和<code>misr_reg</code>都是8位宽的总线寄存器，具有异步置位（AS&#x3D;Y）功能，但没有异步复位、同步复位或同步置位功能。这些属性对于DFT工具了解如何正确地将这些寄存器转换为扫描寄存器非常重要。另外我们还可以看到所有HDLC识别出来的寄存器都是ST（N）即没有加入MUX的格式，可以联想上一篇博客对scanchain的介绍，后边为了连接scanchain势必要替换这些cell。</p>
<h3 id="定义时钟门控（重要）"><a href="#定义时钟门控（重要）" class="headerlink" title="定义时钟门控（重要）"></a>定义时钟门控（重要）</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/img20250528194303158.png"></p>
<p>此报告显示了使用<code>set_clock_gating_style</code>命令配置的时钟门控设置及其结果：</p>
<p><strong>配置结果详解</strong>：</p>
<p><strong>Sequential cell: latch</strong></p>
<ul>
<li>使用锁存器作为时钟门控的时序单元，这是最常见的时钟门控实现方式</li>
</ul>
<p><strong>Minimum bank bitwidth: 8</strong></p>
<ul>
<li>只有当控制的寄存器位宽≥8位时才会插入时钟门控单元</li>
<li>这避免了对小型寄存器组使用门控，因为门控电路本身的开销可能超过节省的功耗</li>
</ul>
<p><strong>Minimum bank bitwidth for enhanced clock gating: 16</strong></p>
<ul>
<li>增强型时钟门控（通常具有更复杂的控制逻辑）仅用于位宽≥16位的寄存器组</li>
</ul>
<p><strong>Maximum fanout: 32</strong></p>
<ul>
<li>每个时钟门控单元最多控制32个寄存器</li>
<li>超过此数量将创建额外的门控单元以分担负载</li>
</ul>
<p><strong>Setup time for clock gate: 0.000000</strong><br><strong>Hold time for clock gate: 0.000000</strong></p>
<ul>
<li>时钟门控单元的建立和保持时间设置为零（使用库默认值）</li>
</ul>
<p><strong>Clock gating circuitry (positive edge): and</strong></p>
<ul>
<li>上升沿触发的门控使用AND门实现</li>
</ul>
<p><strong>Clock gating circuitry (negative edge): or</strong></p>
<ul>
<li>下降沿触发的门控使用OR门实现</li>
</ul>
<p><strong>Note: inverter between clock gating circuitry and (negative edge) observation clock pin</strong></p>
<ul>
<li>对于负边沿观察点，在门控电路和时钟引脚之间插入反相器</li>
</ul>
<p><strong>Control point insertion: before</strong></p>
<ul>
<li>门控控制点插入在时钟路径的前端，这通常提供更好的功耗节省</li>
</ul>
<p><strong>Control signal for control point: scan_enable</strong></p>
<ul>
<li>使用scan_enable信号作为控制点的控制信号，这在测试模式下很重要</li>
</ul>
<p><strong>Observation point insertion: false</strong></p>
<ul>
<li>不插入观察点，用于调试或可观测性</li>
</ul>
<p><strong>Observation logic depth: 5</strong></p>
<ul>
<li>观察逻辑的最大深度为5级</li>
</ul>
<p><strong>No sharing of register banks: enabled</strong></p>
<ul>
<li>禁用寄存器组共享，每个门控组独立控制</li>
<li>这增加了面积但提高了功耗控制的精确度</li>
</ul>
<p>这些设置确保了时钟门控的最佳实现，在功耗优化和电路复杂度之间取得平衡。</p>
<h2 id="compile反馈"><a href="#compile反馈" class="headerlink" title="compile反馈"></a>compile反馈</h2><h3 id="information"><a href="#information" class="headerlink" title="information"></a>information</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/img20250528195315610.png"></p>
<p>DC在编译过程中提供了以下重要信息：</p>
<p><strong>警告信息</strong>：DesignWare合成库(dw_foundation.sldb)被添加到当前命令的合成库中。</p>
<p><strong>常量传播</strong>：从2013.12版本开始，即使禁用边界优化，常量传播也会启用。</p>
<p><strong>功耗优化</strong>：DC正在执行功耗优化(PWR-850)，这对降低设计功耗非常重要。</p>
<p><strong>库文件状态</strong>：所有库文件都是最新的，确保使用最新的单元库。</p>
<p><strong>测试方法限制</strong>：选择测试方法会限制时序单元的优化，这是DFT插入的必要代价。</p>
<p><strong>顺序输出反转</strong>：顺序输出反转已启用，SVF文件将用于格式验证。</p>
<p><strong>潜在问题警告</strong>：设计中存在3个潜在问题，建议运行’check_design’获取更多信息。</p>
<p><strong>设计简化</strong>：DC正在简化”multiplier_4bit_lbist”设计，这是综合过程的一部分。</p>
<p>这些信息表明综合过程正常进行，同时提醒设计者注意某些可能影响最终结果的因素。</p>
<h3 id="warning"><a href="#warning" class="headerlink" title="warning"></a>warning</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/img20250528195620963.png"><br>出现这个问题的原因很简单，我们选择了compile -scan 目的就是替换设计中的普通触发器为扫描触发器，warning是因为原始触发器本身就带有扫描引脚。不过不用在意，因为不管是替换成什么触发器单元都会是scanenable的触发器，而这一过程完全由dc来完成即可。</p>
<p>###优化阶段和阈值电压器件选择<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/img20250528200415002.png"></p>
<p>在Design Compiler的综合过程中，系统进行了多阶段的优化并对阈值电压单元进行了选择：</p>
<p><strong>优化阶段</strong>：</p>
<ul>
<li>映射优化（Ultra High effort级别）</li>
<li>常量寄存器移除</li>
<li>全局优化（第46-75阶段）</li>
</ul>
<p><strong>阈值电压单元使用情况</strong>：</p>
<ul>
<li>saed90cell（标准阈值电压）：0.00%</li>
<li>saed90cell_hvt（高阈值电压）：100.00%</li>
<li>saed90cell_lvt（低阈值电压）：0.00%</li>
</ul>
<p>综合工具完全选择了高阈值电压单元，这表明设计优先考虑低功耗而非高性能。高阈值电压单元具有较低的漏电流，但开关速度较慢，适合对功耗敏感但对性能要求不是特别高的应用场景。这种选择是因为规定了电路功耗为0的限制，即在满足时序要求的前提下最小化功耗消耗。通过全部使用高阈值电压单元，可以显著降低静态功耗，形成了dc软件对高阈值电压器件的选择。</p>
<h3 id="compile后report-violation没有错误"><a href="#compile后report-violation没有错误" class="headerlink" title="compile后report violation没有错误"></a>compile后report violation没有错误</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/img20250528194954035.png"></p>
<p>测试协议(Test Protocol)是DFT设计中的关键组成部分，它定义了芯片测试的完整操作流程。在本设计中，通过<code>create_test_protocol</code>命令生成的测试协议包含了扫描链配置(2条链)、测试信号定义(scan_en、si、so等)、时序参数(时钟45&#x2F;55占空比)以及BIST相关控制信号(test_mode、bist_en等)的完整描述。测试协议文件(.spf)作为设计与测试之间的桥梁，为后续的ATPG(自动测试模式生成)提供必要指导，同时确保测试逻辑的正确实现。通过严格定义的测试协议，可以保证芯片制造后能够进行高覆盖率、高效率的测试，从而提高产品质量和可靠性。</p>
<h3 id="set完scanchain-bist-autofix后生test-protocol"><a href="#set完scanchain-bist-autofix后生test-protocol" class="headerlink" title="set完scanchain bist autofix后生test_protocol"></a>set完scanchain bist autofix后生test_protocol</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/img20250528231426113.png"></p>
<h3 id="生成测试协议后进行dft-drc测试"><a href="#生成测试协议后进行dft-drc测试" class="headerlink" title="生成测试协议后进行dft_drc测试"></a>生成测试协议后进行dft_drc测试</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/img20250528232008904.png"><br>可以看到有三个门控时钟显示没有连接<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/img20250528231935967.png"><br>具体到电路看看<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/img20250528232112898.png"><br>原来是门控时钟的TE端接地了，一般这个端口应该直接连接scan_en pin，原因就在这里，由于我们还没有进行insert<br>所以scan_en这个在综合阶段才加入的pin没有加入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/img20250528232304361.png"><br>它们还趴在原理图的左下角，没有进行连线。因此这个drc等insert后就会自动修复了，不必担心。</p>
<h3 id="Preview-dft可以提前看到scanchain的起始"><a href="#Preview-dft可以提前看到scanchain的起始" class="headerlink" title="Preview_dft可以提前看到scanchain的起始"></a>Preview_dft可以提前看到scanchain的起始</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/img20250528232543537.png"></p>
<h3 id="insert-dft"><a href="#insert-dft" class="headerlink" title="insert_dft"></a>insert_dft</h3><p>接下来就是最重要的一步，dft电路的插入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/img20250528233000350.png"><br>可以看到，即使在insert的时候出现了drc错误，工具不会先报错，而是通过我们设置的autofix来修复drc</p>
<h3 id="插入完了进行一下dft-drc"><a href="#插入完了进行一下dft-drc" class="headerlink" title="插入完了进行一下dft_drc"></a>插入完了进行一下dft_drc</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/img20250528233201161.png"><br>完美！</p>
<p>至此我们完成了scanchain的插入，下一篇讲解lbist的逻辑部分，代码实现部分与scanchain在一起完成插入了。<br>希望有更多时间更新博客！</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://butcs-icwork-bentch.github.io">butc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://butcs-icwork-bentch.github.io/2025/05/28/DFT2%E5%AE%9E%E6%93%8D/">https://butcs-icwork-bentch.github.io/2025/05/28/DFT2%E5%AE%9E%E6%93%8D/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://butcs-icwork-bentch.github.io" target="_blank">Welcome to butcs-icworkbentch</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/DFT%EF%BC%8C%E5%8F%AF%E6%B5%8B%E6%80%A7%E8%AE%BE%E8%AE%A1%EF%BC%8C%E7%BB%BC%E5%90%88/">DFT，可测性设计，综合</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/imgOIP-C.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/02/10/DFT2/" title="DFT学习（2）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">DFT学习（2）</div></div><div class="info-2"><div class="info-item-1">SCAN CHAIN &amp;&amp; ATPG在学习scanchain之前，我们必须要清楚，不同的dft电路检测chip的角度是不同的，比如本篇文章所讲scan chain结构，是最常用的dft电路，但scan test只能完整检测出scan chain部分的制造缺陷，即使有ATPG(Automatic Test Pattern Generation)用于检测逻辑，但是其覆盖率并不能达到最大化，仍需要搭配BIST使用，对于工业级，车规级，军用级chip来说，其可靠性要求很高，通常需要测试覆盖率达到99%以上，因此合理组合搭配dft电路尤为重要。 SCAN CHAIN 原理在数字芯片中，时序逻辑可以简单理解为组合逻辑与触发器的层次化连接关系，通过clk（上升&#x2F;下降）沿将每一级的信息传递给下一级，扫描链的插入就是指将普通寄存器替换成为扫描寄存器（scan flip-flop）的过程。如图原始的时序电路结构将D触发器替换为DFF替换后的时序电路可以看到，DFF就是对D触发器加入了一个MUX结构，SE scan...</div></div></div></a><a class="pagination-related" href="/2025/06/03/PCB%E7%BB%98%E5%88%B6/" title="PCB绘制"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">PCB绘制</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/02/01/DFT1/" title="DFT学习（1）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-01</div><div class="info-item-2">DFT学习（1）</div></div><div class="info-2"><div class="info-item-1">DFT可测性设计简介在现代集成电路设计中，DFT（Design For Testability，可测性设计）已成为不可或缺的关键环节。随着芯片复杂度的不断提升，传统的测试方法已无法满足大规模集成电路的测试需求。DFT通过在芯片设计阶段就考虑测试需求，引入扫描链、内建自测试等测试结构，不仅能够显著提高测试效率、降低测试成本，还能确保产品的质量和可靠性。通过DFT技术，可以及时发现并筛选出有缺陷的芯片，提高产品良率，降低返修率，同时大大缩短产品测试周期，加快产品上市速度。在当今竞争激烈的半导体市场中，掌握和应用DFT技术已成为提升产品竞争力的重要手段，它不仅关系到产品的质量和可靠性，也直接影响着产品的开发周期和成本，对整个半导体产业的发展起着重要的推动作用。 DFT可测性电路分类DFT可测性电路主要可以分为以下几类： 扫描链（Scan...</div></div></div></a><a class="pagination-related" href="/2025/02/10/DFT2/" title="DFT学习（2）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-10</div><div class="info-item-2">DFT学习（2）</div></div><div class="info-2"><div class="info-item-1">SCAN CHAIN &amp;&amp; ATPG在学习scanchain之前，我们必须要清楚，不同的dft电路检测chip的角度是不同的，比如本篇文章所讲scan chain结构，是最常用的dft电路，但scan test只能完整检测出scan chain部分的制造缺陷，即使有ATPG(Automatic Test Pattern Generation)用于检测逻辑，但是其覆盖率并不能达到最大化，仍需要搭配BIST使用，对于工业级，车规级，军用级chip来说，其可靠性要求很高，通常需要测试覆盖率达到99%以上，因此合理组合搭配dft电路尤为重要。 SCAN CHAIN 原理在数字芯片中，时序逻辑可以简单理解为组合逻辑与触发器的层次化连接关系，通过clk（上升&#x2F;下降）沿将每一级的信息传递给下一级，扫描链的插入就是指将普通寄存器替换成为扫描寄存器（scan flip-flop）的过程。如图原始的时序电路结构将D触发器替换为DFF替换后的时序电路可以看到，DFF就是对D触发器加入了一个MUX结构，SE scan...</div></div></div></a><a class="pagination-related" href="/2025/06/04/DFT3/" title="DFT学习（3）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-04</div><div class="info-item-2">DFT学习（3）</div></div><div class="info-2"><div class="info-item-1">LBIST在上一学习中，我们展示了不完备LBIST的建立方法，为什么说是不完备的呢？诸位可以看看代码组成 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114// 纯LBIST结构乘法器(无扫描链)module multiplier_4bit_lbist(    input clk,           // 时钟信号    input rst_n,         // 复位信号    input test_mode,     // 测试模式信号    input bist_en,       // BIST使能信号    input bist_start,   ...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/imgOIP-C.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">butc</div><div class="author-info-description">一个分享技术、生活、学习、工作、创业等内容的博客</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/butcs-icwork-bentch"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https:2806483105@qq.com" target="_blank" title="QQ"><i class="fab fa-QQ" style="color: #24292e;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80%E5%9B%9E%E9%A1%BE"><span class="toc-number">1.</span> <span class="toc-text">理论基础回顾</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Scan-Chain%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.</span> <span class="toc-text">Scan Chain基本原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ATPG%EF%BC%88%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95%E5%90%91%E9%87%8F%E7%94%9F%E6%88%90%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">ATPG（自动测试向量生成）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%B9%98%E6%B3%95%E5%99%A8%E5%8A%A0%E5%85%A5%EF%BC%88%E4%B8%8D%E5%AE%8C%E5%A4%87%EF%BC%89LBIST%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">为乘法器加入（不完备）LBIST测试结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E4%BB%BF%E7%9C%9F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B%E6%A6%82%E8%BF%B0"><span class="toc-number">1.3.1.</span> <span class="toc-text">前仿真测试过程概述</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RTL%E5%89%8D%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C"><span class="toc-number">1.4.</span> <span class="toc-text">RTL前仿真结果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Design-Compiler-DFT%E7%BB%BC%E5%90%88%E5%B9%B6%E6%8F%92%E5%85%A5scanchain"><span class="toc-number">1.5.</span> <span class="toc-text">使用Design Compiler DFT综合并插入scanchain</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DC%E9%87%8D%E8%A6%81%E6%8A%A5%E5%91%8A%E5%8F%8D%E9%A6%88"><span class="toc-number">1.6.</span> <span class="toc-text">DC重要报告反馈</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E8%BF%9B%E8%A1%8Clink%E4%B9%8B%E5%90%8EDC%E4%BC%9A%E6%89%93%E5%BC%80%E8%87%AA%E5%B8%A6%E7%9A%84DHL-Compiler%E5%AF%B9v%E4%BB%A3%E7%A0%81%E8%BF%9B%E8%A1%8C%E7%BC%96%E8%AF%91"><span class="toc-number">1.6.1.</span> <span class="toc-text">在进行link之后DC会打开自带的DHL Compiler对v代码进行编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E6%97%B6%E9%92%9F%E9%97%A8%E6%8E%A7%EF%BC%88%E9%87%8D%E8%A6%81%EF%BC%89"><span class="toc-number">1.6.2.</span> <span class="toc-text">定义时钟门控（重要）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#compile%E5%8F%8D%E9%A6%88"><span class="toc-number">1.7.</span> <span class="toc-text">compile反馈</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#information"><span class="toc-number">1.7.1.</span> <span class="toc-text">information</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#warning"><span class="toc-number">1.7.2.</span> <span class="toc-text">warning</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#compile%E5%90%8Ereport-violation%E6%B2%A1%E6%9C%89%E9%94%99%E8%AF%AF"><span class="toc-number">1.7.3.</span> <span class="toc-text">compile后report violation没有错误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set%E5%AE%8Cscanchain-bist-autofix%E5%90%8E%E7%94%9Ftest-protocol"><span class="toc-number">1.7.4.</span> <span class="toc-text">set完scanchain bist autofix后生test_protocol</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E6%B5%8B%E8%AF%95%E5%8D%8F%E8%AE%AE%E5%90%8E%E8%BF%9B%E8%A1%8Cdft-drc%E6%B5%8B%E8%AF%95"><span class="toc-number">1.7.5.</span> <span class="toc-text">生成测试协议后进行dft_drc测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Preview-dft%E5%8F%AF%E4%BB%A5%E6%8F%90%E5%89%8D%E7%9C%8B%E5%88%B0scanchain%E7%9A%84%E8%B5%B7%E5%A7%8B"><span class="toc-number">1.7.6.</span> <span class="toc-text">Preview_dft可以提前看到scanchain的起始</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#insert-dft"><span class="toc-number">1.7.7.</span> <span class="toc-text">insert_dft</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E5%AE%8C%E4%BA%86%E8%BF%9B%E8%A1%8C%E4%B8%80%E4%B8%8Bdft-drc"><span class="toc-number">1.7.8.</span> <span class="toc-text">插入完了进行一下dft_drc</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/04/DFT3/" title="DFT学习（3）">DFT学习（3）</a><time datetime="2025-06-04T04:45:00.000Z" title="发表于 2025-06-04 12:45:00">2025-06-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/04/DFT3_tessent_CSDN/" title="DFT_tessent_csdn">DFT_tessent_csdn</a><time datetime="2025-06-04T04:45:00.000Z" title="发表于 2025-06-04 12:45:00">2025-06-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/03/PCB%E7%BB%98%E5%88%B6/" title="PCB绘制">PCB绘制</a><time datetime="2025-06-03T05:20:00.000Z" title="发表于 2025-06-03 13:20:00">2025-06-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/28/DFT2%E5%AE%9E%E6%93%8D/" title="DFT学习（2）实操">DFT学习（2）实操</a><time datetime="2025-05-28T15:36:00.000Z" title="发表于 2025-05-28 23:36:00">2025-05-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/10/DFT2/" title="DFT学习（2）">DFT学习（2）</a><time datetime="2025-02-10T15:00:00.000Z" title="发表于 2025-02-10 23:00:00">2025-02-10</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/butcs-icwork-bentch/blogimg@main/imgshaqiu.png);"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By butc</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.3.5/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.3.5/source/js/main.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>